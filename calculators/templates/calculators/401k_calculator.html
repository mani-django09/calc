{% extends 'calculators/base.html' %}
{% load static %}

{% block title %}401k Calculator - Plan Your Retirement Savings | Free Tool{% endblock %}

{% block content %}
<style>
/* Clean 401k Calculator Styles */
.calculator-401k-page {
    font-family: Arial, sans-serif;
    font-size: 14px;
    line-height: 1.5;
    color: #333;
    background: white;
}

/* Breadcrumb */
.breadcrumb-nav {
    font-size: 12px;
    color: #666;
    margin: 0;
    padding: 10px 20px 8px 20px;
    background: #f9f9f9;
    max-width: 1200px;
    margin: 0 auto;
}

.breadcrumb-nav a {
    color: #0066cc;
    text-decoration: none;
}

.breadcrumb-nav a:hover {
    text-decoration: underline;
}

/* Compact Hero Banner */
.hero-banner {
    background: linear-gradient(135deg, #1f4788 0%, #2d5aa0 100%);
    color: white;
    padding: 15px 20px;
    margin: 0;
    border-bottom: 2px solid #163a6d;
}

.hero-content {
    max-width: 1200px;
    margin: 0 auto;
}

.hero-content h1 {
    font-size: 24px;
    font-weight: normal;
    margin: 0 0 6px 0;
    color: white;
}

.hero-subtitle {
    font-size: 14px;
    opacity: 0.93;
    margin: 0 0 8px 0;
    line-height: 1.4;
    max-width: 800px;
}

.hero-features {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    font-size: 13px;
}

.hero-feature {
    display: flex;
    align-items: center;
    gap: 5px;
}

.hero-feature i {
    font-size: 12px;
}

/* Content Wrapper */
.content-wrapper {
    max-width: 1200px;
    margin: 0 auto;
    padding: 15px 20px;
}

/* Main Layout */
.main-layout {
    display: flex;
    gap: 20px;
}

.left-content {
    flex: 1;
    max-width: 800px;
}

.right-sidebar {
    width: 280px;
    flex-shrink: 0;
}

/* Instruction Banner */
.instruction-banner {
    background: #4a90e2;
    color: white;
    padding: 8px 15px;
    margin-bottom: 15px;
    border-radius: 4px;
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 6px;
}

.check-icon {
    font-weight: bold;
}

/* Calculator Form */
.calculator-form {
    background: #f0f0f0;
    border: 1px solid #ccc;
    margin-bottom: 20px;
}

.form-table {
    width: 100%;
    border-collapse: collapse;
}

.form-table td {
    padding: 12px 15px;
    border-bottom: 1px solid #ddd;
    vertical-align: middle;
}

.form-table tr:last-child td {
    border-bottom: none;
}

.label-cell {
    background: #f8f8f8;
    font-weight: normal;
    width: 200px;
    color: #333;
    font-size: 13px;
}

.input-cell {
    background: white;
}

.button-cell {
    background: white;
    text-align: center;
    padding: 15px;
}

/* Form Inputs */
.form-input, .form-select {
    padding: 6px 8px;
    border: 1px solid #ccc;
    font-size: 13px;
    background: white;
    box-sizing: border-box;
}

.form-input {
    width: 120px;
}

.form-select {
    width: 180px;
}

.form-input:focus, .form-select:focus {
    outline: none;
    border-color: #4a90e2;
}

.input-hint {
    display: block;
    font-size: 11px;
    color: #666;
    margin-top: 3px;
}

/* Calculate Button */
.calculate-button {
    background: #5cb85c;
    color: white;
    border: none;
    padding: 8px 20px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    display: inline-flex;
    align-items: center;
    gap: 5px;
    transition: background 0.2s;
}

.calculate-button:hover:not(:disabled) {
    background: #449d44;
}

.calculate-button:disabled {
    background: #ccc;
    cursor: not-allowed;
}

.play-icon {
    font-size: 12px;
}

/* Loading Spinner */
.loading-spinner {
    display: none;
    margin-left: 8px;
}

.loading-spinner.show {
    display: inline-block;
}

/* Results Section */
.results-container {
    background: white;
    border: 1px solid #ddd;
    padding: 20px;
    margin-bottom: 20px;
    border-radius: 4px;
}

.results-container h3 {
    margin: 0 0 15px 0;
    font-size: 16px;
    font-weight: normal;
    color: #333;
}

.results-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    margin-bottom: 20px;
}

.result-card {
    text-align: center;
    padding: 15px;
    background: #f9f9f9;
    border: 1px solid #e0e0e0;
    border-radius: 3px;
}

.result-label {
    font-size: 11px;
    color: #666;
    margin-bottom: 5px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.result-value {
    font-size: 20px;
    font-weight: bold;
    color: #333;
    margin-bottom: 3px;
}

.result-value.highlight {
    color: #28a745;
    font-size: 28px;
}

.result-subtitle {
    font-size: 11px;
    color: #666;
}

/* Year by Year Growth */
.growth-section {
    margin-top: 20px;
}

.growth-section h4 {
    font-size: 14px;
    font-weight: normal;
    color: #333;
    margin-bottom: 10px;
}

.growth-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
    background: white;
}

.growth-table th {
    background: #4a90e2;
    color: white;
    padding: 8px 6px;
    text-align: left;
    font-weight: normal;
}

.growth-table td {
    padding: 6px;
    border-bottom: 1px solid #e9ecef;
}

.growth-table tr:hover {
    background: #f8f9fa;
}

.growth-table .currency {
    text-align: right;
}

/* Empty State */
.empty-results {
    text-align: center;
    padding: 40px 20px;
    color: #666;
}

.empty-results i {
    font-size: 3rem;
    color: #ddd;
    margin-bottom: 15px;
    display: block;
}

/* Tips Section */
.tips-section {
    margin-top: 30px;
    padding: 20px;
    background: white;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.tips-section h3 {
    font-size: 16px;
    font-weight: normal;
    color: #333;
    margin-bottom: 15px;
}

.tips-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
}

.tip-card {
    padding: 12px;
    background: #f9f9f9;
    border-radius: 3px;
    border-left: 3px solid #28a745;
    font-size: 12px;
}

.tip-card h4 {
    color: #333;
    margin: 0 0 5px 0;
    font-size: 13px;
    font-weight: normal;
}

.tip-card p {
    color: #666;
    margin: 0;
    line-height: 1.4;
}

/* SEO Content */
.seo-content {
    margin-top: 30px;
    padding: 20px;
    background: white;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.seo-content h2 {
    color: #1f4788;
    font-size: 18px;
    font-weight: normal;
    margin: 0 0 15px 0;
}

.seo-content h3 {
    color: #333;
    font-size: 15px;
    font-weight: normal;
    margin: 20px 0 10px 0;
}

.seo-content p {
    color: #666;
    line-height: 1.6;
    margin-bottom: 12px;
    text-align: justify;
}

.seo-content ul {
    color: #666;
    padding-left: 20px;
    margin-bottom: 12px;
}

.seo-content li {
    margin-bottom: 6px;
    line-height: 1.5;
}

/* Sidebar */
.search-section {
    margin-bottom: 20px;
    display: flex;
    gap: 5px;
}

.search-input {
    flex: 1;
    padding: 6px 8px;
    border: 1px solid #ccc;
    font-size: 13px;
    border-radius: 2px;
}

.search-button {
    background: #4a90e2;
    color: white;
    border: none;
    padding: 6px 12px;
    cursor: pointer;
    font-size: 13px;
    border-radius: 2px;
}

.sidebar-widget {
    border: 1px solid #ddd;
    margin-bottom: 20px;
    border-radius: 3px;
}

.widget-header {
    background: #4a90e2;
    color: white;
    padding: 10px 15px;
    font-weight: normal;
    font-size: 14px;
}

.widget-content {
    padding: 15px;
}

.calculator-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}

.calc-column {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.calc-link {
    color: #0066cc;
    text-decoration: none;
    font-size: 13px;
    padding: 2px 0;
}

.calc-link:hover {
    text-decoration: underline;
}

.calc-link.active {
    color: #cc0000;
}

/* Responsive Design */
@media (max-width: 768px) {
    .breadcrumb-nav {
        padding: 8px 15px 6px 15px;
        font-size: 11px;
    }
    
    .hero-banner {
        padding: 12px 15px;
    }
    
    .hero-content h1 {
        font-size: 18px;
        margin-bottom: 5px;
    }
    
    .hero-subtitle {
        font-size: 12px;
        margin-bottom: 6px;
    }
    
    .hero-features {
        gap: 10px;
        font-size: 11px;
    }
    
    .hero-feature i {
        font-size: 10px;
    }
    
    .content-wrapper {
        padding: 12px 15px;
    }
    
    .main-layout {
        flex-direction: column;
    }
    
    .right-sidebar {
        width: 100%;
    }
    
    .label-cell {
        width: auto;
        display: block;
        padding: 10px 15px 5px;
        border-bottom: none;
    }
    
    .input-cell {
        display: block;
        padding: 5px 15px 10px;
    }
    
    .form-input {
        width: 100%;
        max-width: 200px;
    }
    
    .form-select {
        width: 100%;
        max-width: 250px;
    }
    
    .results-grid {
        grid-template-columns: 1fr;
    }
    
    .tips-grid {
        grid-template-columns: 1fr;
    }
    
    .calculator-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 480px) {
    .hero-content h1 {
        font-size: 16px;
    }
    
    .hero-subtitle {
        font-size: 11px;
    }
    
    .hero-features {
        flex-direction: column;
        gap: 6px;
    }
    
    .form-input,
    .form-select {
        font-size: 16px;
    }
}
</style>

<div class="calculator-401k-page">
    <!-- Breadcrumb -->
    <div class="breadcrumb-nav">
        <a href="{% url 'calculators:home' %}">home</a> / 
        <a href="{% url 'calculators:home' %}">financial</a> / 
        <span>401k calculator</span>
    </div>

    <!-- Hero Banner -->
    <section class="hero-banner">
        <div class="hero-content">
            <h1>401k Calculator</h1>
            <p class="hero-subtitle">
                See how much you could have saved by retirement. Factor in your contributions, company match, and investment returns.
            </p>
            <div class="hero-features">
                <div class="hero-feature">
                    <i class="fas fa-check-circle"></i>
                    <span>Instant Results</span>
                </div>
                <div class="hero-feature">
                    <i class="fas fa-chart-line"></i>
                    <span>Year by Year Growth</span>
                </div>
                <div class="hero-feature">
                    <i class="fas fa-mobile-alt"></i>
                    <span>Works on Phone</span>
                </div>
                <div class="hero-feature">
                    <i class="fas fa-calculator"></i>
                    <span>Completely Free</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <div class="content-wrapper">
        <div class="main-layout">
            <!-- Left Content -->
            <div class="left-content">
                <!-- Instruction Banner -->
                <div class="instruction-banner">
                    <span class="check-icon">✓</span>
                    Fill in your numbers and hit Calculate
                </div>

                <!-- Calculator Form -->
                <div class="calculator-form">
                    <form id="calc-form" method="post">
                        {% csrf_token %}
                        <table class="form-table">
                            <tr>
                                <td class="label-cell">Current Age</td>
                                <td class="input-cell">
                                    <input type="number" 
                                           id="current_age" 
                                           name="current_age" 
                                           class="form-input" 
                                           placeholder="30"
                                           value="{{ form_data.current_age|default:'' }}"
                                           min="18"
                                           max="100"
                                           required>
                                    <span class="input-hint">How old are you now?</span>
                                </td>
                            </tr>
                            <tr>
                                <td class="label-cell">Retirement Age</td>
                                <td class="input-cell">
                                    <input type="number" 
                                           id="retirement_age" 
                                           name="retirement_age" 
                                           class="form-input" 
                                           placeholder="65"
                                           value="{{ form_data.retirement_age|default:'65' }}"
                                           min="50"
                                           max="80"
                                           required>
                                    <span class="input-hint">When do you plan to retire?</span>
                                </td>
                            </tr>
                            <tr>
                                <td class="label-cell">Current 401k Balance</td>
                                <td class="input-cell">
                                    <input type="text" 
                                           id="current_balance" 
                                           name="current_balance" 
                                           class="form-input" 
                                           placeholder="50,000"
                                           value="{{ form_data.current_balance|default:'' }}">
                                    <span class="input-hint">What you have saved now (leave blank if $0)</span>
                                </td>
                            </tr>
                            <tr>
                                <td class="label-cell">Annual Salary</td>
                                <td class="input-cell">
                                    <input type="text" 
                                           id="annual_salary" 
                                           name="annual_salary" 
                                           class="form-input" 
                                           placeholder="75,000"
                                           value="{{ form_data.annual_salary|default:'' }}"
                                           required>
                                    <span class="input-hint">Your yearly income before taxes</span>
                                </td>
                            </tr>
                            <tr>
                                <td class="label-cell">Your Contribution (%)</td>
                                <td class="input-cell">
                                    <input type="number" 
                                           id="contribution_rate" 
                                           name="contribution_rate" 
                                           class="form-input" 
                                           placeholder="6"
                                           value="{{ form_data.contribution_rate|default:'6' }}"
                                           step="0.5"
                                           min="0"
                                           max="100"
                                           required>
                                    <span class="input-hint">What percent of salary you contribute</span>
                                </td>
                            </tr>
                            <tr>
                                <td class="label-cell">Employer Match (%)</td>
                                <td class="input-cell">
                                    <input type="number" 
                                           id="employer_match" 
                                           name="employer_match" 
                                           class="form-input" 
                                           placeholder="3"
                                           value="{{ form_data.employer_match|default:'3' }}"
                                           step="0.5"
                                           min="0"
                                           max="100">
                                    <span class="input-hint">What your company matches (0 if none)</span>
                                </td>
                            </tr>
                            <tr>
                                <td class="label-cell">Annual Return Rate (%)</td>
                                <td class="input-cell">
                                    <input type="number" 
                                           id="return_rate" 
                                           name="return_rate" 
                                           class="form-input" 
                                           placeholder="7"
                                           value="{{ form_data.return_rate|default:'7' }}"
                                           step="0.1"
                                           min="0"
                                           max="20"
                                           required>
                                    <span class="input-hint">Expected annual growth (7% is typical)</span>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2" class="button-cell">
                                    <button type="submit" class="calculate-button" id="calculate-btn">
                                        <span class="play-icon">▶</span> Calculate
                                        <span class="loading-spinner" id="loading-spinner">
                                            <i class="fas fa-spinner fa-spin"></i>
                                        </span>
                                    </button>
                                </td>
                            </tr>
                        </table>
                    </form>
                </div>

                <!-- Results Section -->
                <div id="results-section" {% if not result %}style="display: none;"{% endif %}>
                    <div class="results-container">
                        <h3>Your Retirement Savings</h3>
                        {% if result %}
                        <div class="results-grid">
                            <div class="result-card">
                                <div class="result-label">Total at Retirement</div>
                                <div class="result-value highlight">${{ result.total_at_retirement|floatformat:0 }}</div>
                                <div class="result-subtitle">What you'll have saved</div>
                            </div>
                            <div class="result-card">
                                <div class="result-label">Your Contributions</div>
                                <div class="result-value">${{ result.total_contributions|floatformat:0 }}</div>
                                <div class="result-subtitle">Money you put in</div>
                            </div>
                            <div class="result-card">
                                <div class="result-label">Employer Contributions</div>
                                <div class="result-value">${{ result.employer_contributions|floatformat:0 }}</div>
                                <div class="result-subtitle">Free money from company</div>
                            </div>
                            <div class="result-card">
                                <div class="result-label">Investment Growth</div>
                                <div class="result-value">${{ result.investment_growth|floatformat:0 }}</div>
                                <div class="result-subtitle">Earnings from returns</div>
                            </div>
                        </div>

                        <!-- Year by Year Growth -->
                        {% if result.yearly_breakdown %}
                        <div class="growth-section">
                            <h4>First 10 Years of Growth</h4>
                            <div style="overflow-x: auto;">
                                <table class="growth-table">
                                    <thead>
                                        <tr>
                                            <th>Age</th>
                                            <th>Your Contribution</th>
                                            <th>Employer Match</th>
                                            <th>Interest Earned</th>
                                            <th>End Balance</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for year in result.yearly_breakdown %}
                                        <tr>
                                            <td>{{ year.age }}</td>
                                            <td class="currency">${{ year.contribution|floatformat:0 }}</td>
                                            <td class="currency">${{ year.employer|floatformat:0 }}</td>
                                            <td class="currency">${{ year.interest|floatformat:0 }}</td>
                                            <td class="currency">${{ year.balance|floatformat:0 }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        {% endif %}
                        {% else %}
                        <div class="empty-results">
                            <i class="fas fa-piggy-bank"></i>
                            <p>Enter your info above to see how much you could have by retirement.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Tips Section -->
                <div class="tips-section">
                    <h3>Making the Most of Your 401k</h3>
                    <div class="tips-grid">
                        <div class="tip-card">
                            <h4>Always Get the Full Match</h4>
                            <p>If your employer matches up to 5%, contribute at least 5%. It's literally free money sitting on the table - don't leave it there.</p>
                        </div>
                        <div class="tip-card">
                            <h4>Start as Early as You Can</h4>
                            <p>Time is your biggest advantage. Starting at 25 instead of 35 can literally double what you have at retirement, even with the same contributions.</p>
                        </div>
                        <div class="tip-card">
                            <h4>Bump It Up Every Year</h4>
                            <p>When you get a raise, increase your contribution by 1%. You won't even notice it missing, but it adds up to a lot over time.</p>
                        </div>
                        <div class="tip-card">
                            <h4>Don't Touch It Early</h4>
                            <p>Cashing out your 401k when you change jobs kills your retirement. Between taxes, penalties, and lost growth, you lose way more than you think.</p>
                        </div>
                    </div>
                </div>

                <!-- SEO Content -->
                <div class="seo-content">
                    <h2>Understanding Your 401k</h2>
                    
                    <h3>What's a 401k Anyway?</h3>
                    <p>A 401k is basically a retirement savings account your job sets up for you. You put money in from each paycheck before taxes hit it, and that money grows over the years. When you retire, you've got a nice pile of cash waiting for you. The "401k" name comes from the tax code section that created them - thrilling stuff, I know.</p>
                    
                    <h3>The Company Match Thing</h3>
                    <p>This is where it gets good. A lot of companies will match what you put in, up to a certain amount. Like if they match 50% up to 6% of your salary, and you make $60,000, they'll throw in up to $1,800 if you contribute $3,600. That's a 50% return right off the bat. You're not going to beat that anywhere else.</p>
                    
                    <h3>How the Money Grows</h3>
                    <p>Your 401k money gets invested - usually in mutual funds with stocks and bonds. Over time, these investments grow. Some years are better than others, but historically the market averages around 7-10% a year after inflation. That might not sound like much, but thanks to compound interest, it really adds up. Every dollar you invest today could be worth $5 or $10 by the time you retire.</p>
                    
                    <h3>The Tax Angle</h3>
                    <p>Money you put in a traditional 401k comes out before taxes, so it lowers your taxable income now. If you're making $75,000 and contribute $7,500, you only pay taxes on $67,500. You'll pay taxes later when you withdraw it in retirement, but you'll probably be in a lower tax bracket by then. Some companies also offer Roth 401ks where you pay taxes now but not later - depends on your situation.</p>
                    
                    <h3>Common Mistakes to Avoid</h3>
                    <p>Don't contribute so little that you miss the full company match. Don't cash it out when you change jobs - roll it over instead. Don't put it all in super risky investments or super safe ones - you need balance. And don't forget to actually sign up - some companies auto-enroll you, but many don't. Check with HR if you're not sure.</p>
                </div>
            </div>

            <!-- Right Sidebar -->
            <div class="right-sidebar">
                <!-- Search Box -->
                <div class="search-section">
                    <input type="text" class="search-input" placeholder="Search...">
                    <button class="search-button">Search</button>
                </div>

                <!-- Related Calculators -->
                <div class="sidebar-widget">
                    <div class="widget-header">Related Calculators</div>
                    <div class="widget-content">
                        <div class="calculator-grid">
                            <div class="calc-column">
                                <a href="{% url 'calculators:loan_calculator' %}" class="calc-link">Loan</a>
                                <a href="{% url 'calculators:percentage_calculator' %}" class="calc-link">Percentage</a>
                                <a href="{% url 'calculators:bmi_calculator' %}" class="calc-link">BMI</a>
                                <a href="{% url 'calculators:calorie_calculator' %}" class="calc-link">Calorie</a>
                            </div>
                            <div class="calc-column">
                                <a href="{% url 'calculators:age_calculator' %}" class="calc-link">Age</a>
                                <a href="{% url 'calculators:gpa_calculator' %}" class="calc-link">GPA</a>
                                <a href="{% url 'calculators:home' %}" class="calc-link">More Calculators</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('calc-form');
    const calculateBtn = document.getElementById('calculate-btn');
    const loadingSpinner = document.getElementById('loading-spinner');
    const currentBalanceInput = document.getElementById('current_balance');
    const annualSalaryInput = document.getElementById('annual_salary');
    const currentAgeInput = document.getElementById('current_age');
    const retirementAgeInput = document.getElementById('retirement_age');
    const contributionRateInput = document.getElementById('contribution_rate');
    const returnRateInput = document.getElementById('return_rate');
    
    // Format number inputs with commas
    function formatNumber(input) {
        if (input) {
            input.addEventListener('input', function() {
                let value = this.value.replace(/[^0-9]/g, '');
                
                if (value.length > 0) {
                    let number = parseInt(value);
                    if (number > 10000000) {
                        number = 10000000;
                    }
                    this.value = number.toLocaleString();
                }
            });
        }
    }
    
    formatNumber(currentBalanceInput);
    formatNumber(annualSalaryInput);
    
    // Form validation
    function validateForm() {
        const currentAge = parseInt(currentAgeInput.value);
        const retirementAge = parseInt(retirementAgeInput.value);
        const annualSalary = parseFloat(annualSalaryInput.value.replace(/,/g, ''));
        const contributionRate = parseFloat(contributionRateInput.value);
        const returnRate = parseFloat(returnRateInput.value);
        
        let isValid = true;
        
        if (!currentAge || currentAge < 18 || currentAge > 100) {
            isValid = false;
        }
        
        if (!retirementAge || retirementAge < 50 || retirementAge > 80) {
            isValid = false;
        }
        
        if (currentAge >= retirementAge) {
            isValid = false;
        }
        
        if (!annualSalary || annualSalary < 1000 || annualSalary > 10000000) {
            isValid = false;
        }
        
        if (isNaN(contributionRate) || contributionRate < 0 || contributionRate > 100) {
            isValid = false;
        }
        
        if (isNaN(returnRate) || returnRate < 0 || returnRate > 20) {
            isValid = false;
        }
        
        calculateBtn.disabled = !isValid;
        return isValid;
    }
    
    // Add validation listeners
    [currentAgeInput, retirementAgeInput, annualSalaryInput, contributionRateInput, returnRateInput].forEach(input => {
        if (input) {
            input.addEventListener('input', validateForm);
            input.addEventListener('blur', validateForm);
        }
    });
    
    // Form submission
    if (form) {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!validateForm()) {
                return;
            }
            
            // Show loading state
            if (loadingSpinner) {
                loadingSpinner.classList.add('show');
            }
            calculateBtn.disabled = true;
            
            // Clean number values before submission
            if (currentBalanceInput.value) {
                currentBalanceInput.value = currentBalanceInput.value.replace(/,/g, '');
            }
            annualSalaryInput.value = annualSalaryInput.value.replace(/,/g, '');
            
            // Submit the form
            setTimeout(() => {
                this.submit();
            }, 300);
        });
    }
    
    // Initial validation
    validateForm();
    
    // Format existing values on page load
    if (currentBalanceInput && currentBalanceInput.value) {
        const value = currentBalanceInput.value.replace(/[^0-9]/g, '');
        if (value) {
            currentBalanceInput.value = parseInt(value).toLocaleString();
        }
    }
    
    if (annualSalaryInput && annualSalaryInput.value) {
        const value = annualSalaryInput.value.replace(/[^0-9]/g, '');
        if (value) {
            annualSalaryInput.value = parseInt(value).toLocaleString();
        }
    }
});
</script>

{% if result %}
<script>
// AUTO-SCROLL TO RESULTS
(function() {
    'use strict';
    
    function scrollToResults() {
        const resultsSection = document.getElementById('results-section');
        
        if (!resultsSection) {
            console.log('Results section not found');
            return;
        }
        
        console.log('Scrolling to results section...');
        
        // Make sure it's visible
        resultsSection.style.display = 'block';
        resultsSection.style.visibility = 'visible';
        
        // Wait for layout
        setTimeout(function() {
            const rect = resultsSection.getBoundingClientRect();
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const targetPosition = rect.top + scrollTop - 100;
            
            console.log('Target position:', targetPosition);
            
            // Smooth scroll
            window.scrollTo({
                top: targetPosition,
                behavior: 'smooth'
            });
            
            // Add highlight effect
            resultsSection.style.transition = 'box-shadow 0.5s ease';
            resultsSection.style.boxShadow = '0 0 30px rgba(74, 144, 226, 0.6)';
            
            // Fade highlight
            setTimeout(function() {
                resultsSection.style.boxShadow = '0 0 15px rgba(74, 144, 226, 0.3)';
                
                setTimeout(function() {
                    resultsSection.style.boxShadow = 'none';
                }, 1500);
            }, 600);
            
        }, 100);
    }
    
    // Multiple triggers to ensure it works
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', scrollToResults);
    } else {
        scrollToResults();
    }
    
    window.addEventListener('load', function() {
        setTimeout(scrollToResults, 200);
    });
})();
</script>
{% endif %}

<!-- Schema.org Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "401k Calculator",
  "description": "Free 401k retirement calculator - see how much you could have saved by retirement with your contributions, company match, and investment returns.",
  "url": "{{ request.build_absolute_uri }}",
  "applicationCategory": "FinanceApplication",
  "operatingSystem": "Any",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  },
  "provider": {
    "@type": "Organization",
    "name": "myCalculator.us",
    "url": "{% url 'calculators:home' %}"
  },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.9",
    "ratingCount": "892"
  }
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "How much should I contribute to my 401k?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "At minimum, contribute enough to get your full employer match - that's free money. Most experts recommend saving 10-15% of your income for retirement. If you can't do that yet, start with what you can and increase it by 1% each year when you get a raise."
      }
    },
    {
      "@type": "Question",
      "name": "What's a realistic return rate for my 401k?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Historically, the stock market has averaged around 10% per year, but after inflation that's more like 7%. Most financial planners use 7% for planning purposes. Some years will be better, some worse, but 7% is a reasonable long-term estimate."
      }
    },
    {
      "@type": "Question",
      "name": "Should I max out my 401k?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "If you can afford it, maxing out your 401k is great - the 2024 limit is $23,000 ($30,500 if you're over 50). But first make sure you're getting the full employer match, have an emergency fund, and aren't carrying high-interest debt. Those come first."
      }
    },
    {
      "@type": "Question",
      "name": "What happens to my 401k if I change jobs?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "You have a few options: leave it where it is (if the old employer allows it), roll it over to your new employer's 401k, or roll it into an IRA. Don't cash it out - you'll lose a huge chunk to taxes and penalties, plus all the future growth."
      }
    }
  ]
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{ request.scheme }}://{{ request.get_host }}{% url 'calculators:home' %}"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Financial Calculators",
      "item": "{{ request.scheme }}://{{ request.get_host }}{% url 'calculators:home' %}"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "401k Calculator",
      "item": "{{ request.build_absolute_uri }}"
    }
  ]
}
</script>

{% endblock %}